<html>
<head>
	
	<title>生成高斯模糊效果背景</title>
	<meta name="keywords" content="My Blog, Spider Bitch!" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <!--<link rel="stylesheet" href="/css/main.css">-->
	<link href="/css/main.css?v=2" rel="stylesheet" type="text/css" />
    <!--<link rel="stylesheet" href="/css/style.css">-->
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2"/>
    

</head>

<body>

<p>做开发时，总是使用系统默认的白色背景会显得有些生硬，所以当我们以展示图片为目的时，不妨将图片放大、再做高斯模糊处理以作为背景。</p>
<p>我把这个处理过程用 Swift 封装成了一个函数，供大家参考。</p>
<pre><code>//创建高斯模糊效果的背景
func createBlurBackground (image:<span class="type">UIImage</span>,view:<span class="type">UIView</span>,blurRadius:<span class="type">Float</span>) {
    //处理原始<span class="type">NSData</span>数据
    <span class="keyword">let</span> originImage = <span class="type">CIImage</span>(<span class="type">CGImage</span>: image.<span class="type">CGImage</span> )
    //创建高斯模糊滤镜
    <span class="keyword">let</span> filter = <span class="type">CIFilter</span>(name: <span class="string">"CIGaussianBlur"</span>)
    filter.setValue(originImage, forKey: kCIInputImageKey)
    filter.setValue(<span class="type">NSNumber</span>(<span class="type">float</span>: blurRadius), forKey: <span class="string">"inputRadius"</span>)
    //生成模糊图片
    <span class="keyword">let</span> context = <span class="type">CIContext</span>(options: <span class="keyword">nil</span>)
    <span class="keyword">let</span> <span class="literal">result</span>:<span class="type">CIImage</span> = filter.valueForKey(kCIOutputImageKey) <span class="keyword">as</span>! <span class="type">CIImage</span>
    <span class="keyword">let</span> blurImage = <span class="type">UIImage</span>(<span class="type">CGImage</span>: context.createCGImage(<span class="literal">result</span>, fromRect: <span class="literal">result</span>.extent()))
    //将模糊图片加入背景
    <span class="keyword">let</span> w = self.view.frame.width
    <span class="keyword">let</span> h = self.view.frame.height
    <span class="keyword">let</span> blurImageView = <span class="type">UIImageView</span>(frame: <span class="type">CGRectMake</span>(-w/<span class="number">2</span>, -h/<span class="number">2</span>, <span class="number">2</span>*w, <span class="number">2</span>*h)) //模糊背景是界面的<span class="number">4</span>倍大小
    blurImageView.contentMode = <span class="type">UIViewContentMode</span>.<span class="type">ScaleAspectFill</span> //使图片充满<span class="type">ImageView</span>
    blurImageView.autoresizingMask = <span class="type">UIViewAutoresizing</span>.<span class="type">FlexibleWidth</span> | <span class="type">UIViewAutoresizing</span>.<span class="type">FlexibleHeight</span> //保持原图长宽比
    blurImageView.image = blurImage
    self.view.insertSubview(blurImageView, belowSubview: view) //保证模糊背景在原图片<span class="type">View</span>的下层
}
</code></pre><p>三个参数分别为：image（原始清晰图片）、view（你需要将生成的模糊背景插入在这个view的下层当做背景）、blurRadius（高斯模糊处理的模糊半径）</p>
<p>其中 let context = CIContext(options: nil)<br>这一句，在真机测试时，会引起控制台报错</p>
<p><img src="http://upload-images.jianshu.io/upload_images/251884-26c975e53fe90564.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240" alt="控制台输出"></p>
<p>这是苹果的一个 Bug ，想要回避这个信息输出可以用下面这一句进行替换：<br>let context = CIContext(options:[kCIContextUseSoftwareRenderer : true])<br>这句可以使图片渲染工作在 CPU 而非 GPU 完成，从而绕过这个 Bug，但是会引起效率下降，耗时大大增加，不推荐使用。</p>
<p>使用效果展示：</p>
<pre><code><span class="keyword">self.createBlurBackground(img, </span>view: <span class="keyword">self.gifView, </span><span class="keyword">blurRadius: </span><span class="number">50</span>)
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/251884-7a542aabd1a18eb3.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240" alt="使用前"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/251884-7acd3455f1bcf402.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240" alt="使用后"></p>


<!--<a href="http://kyxu.tech/2015/08/07/生成高斯模糊效果背景/#disqus_thread" class="article-comment-link">Comments</a>-->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'undefined'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script>
</div>







</body>
</html>